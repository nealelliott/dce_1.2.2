#
# @OSF_COPYRIGHT@
# COPYRIGHT NOTICE
# Copyright (c) 1990, 1991, 1992, 1993, 1996 Open Software Foundation, Inc.
# ALL RIGHTS RESERVED (DCE).  See the file named COPYRIGHT.DCE in the
# src directory for the full copyright text.
#
#
#(c) Copyright 1991,1992 Siemens-Nixdorf Information Systems,Burlington,MA,USA.
# All Rights Reserved
#
#
# HISTORY
# $Log: Makefile,v $
# Revision 1.1.20.2  1996/03/09  23:31:42  marty
# 	Update OSF copyright year
# 	[1996/03/09  22:46:51  marty]
#
# Revision 1.1.20.1  1995/12/08  18:13:08  root
# 	Submit OSF/DCE 1.2.1
# 
# 	HP revision /main/HPDCE02/8  1995/07/28  19:37 UTC  pare
# 	Merge changes
# 
# 	HP revision /main/HPDCE02/pare_MOTHRA/2  1995/07/27  19:24 UTC  pare
# 	Add dts_rcr_provider to ILIST -- CHFts15885
# 
# 	HP revision /main/HPDCE02/7  1995/07/25  19:27 UTC  pare
# 	Merge files
# 
# 	HP revision /main/HPDCE02/pare_MOTHRA/1  1995/07/25  12:35 UTC  pare
# 	Re named files with 'ultrix' string -- CHFts15829
# 
# 	HP revision /main/HPDCE02/6  1994/10/27  14:12 UTC  pare
# 	Merge Hpdce02_05 changes
# 	[1995/12/08  17:25:22  root]
# 
# Revision 1.1.16.10  1994/09/30  20:14:00  tom
# 	Add -DDCE_AUD_POINTS to turn on auditing.
# 	[1994/09/30  20:10:06  tom]
# 
# 	HP revision /main/HPDCE02/5  1994/10/10  15:14 UTC  pare
# 	Merge bl21 changes.
# 
# 	HP revision /main/HPDCE02/4  1994/09/26  19:05 UTC  pare
# 	Merge bl18 changes
# 
# Revision 1.1.16.9  1994/09/07  15:48:51  marty
# 	CR # 11497 - Remove '-v' option from IDLFLAGS definition.
# 	[1994/09/06  21:39:44  marty]
# 
# 	HP revision /main/HPDCE02/pare_mothra/1  1994/09/26  18:59 UTC  pare
# 	Move example providers from /bin to usr/examples/dtsi.. .../bin to usr/examples/bin
# 
# 	HP revision /main/HPDCE02/3  1994/08/18  14:28 UTC  pare
# 	Merge changes from Hpdce02
# 
# Revision 1.1.16.8  1994/08/05  20:47:37  cbrooks
# 	CR11240 - add dced config functionality
# 	[1994/08/05  20:23:36  cbrooks]
# 
# 	CR11240 - dced config enhancements
# 	[1994/08/03  14:46:52  cbrooks]
# 
# Revision 1.1.16.7  1994/06/24  19:34:00  cbrooks
# 	CR10792 - change dtstime to dtsdate
# 	[1994/06/24  19:32:57  cbrooks]
# 
# 	CR10792 - add ILINK field for dtstime
# 	[1994/06/23  16:27:41  cbrooks]
# 
# 	HP revision /main/HPDCE02/2  1994/07/05  12:57 UTC  mgm
# 	Fix merge error
# 
# 	HP revision /main/HPDCE02/1  1994/06/29  14:34 UTC  pare
# 	Merge hpdce02
# 	 (DCE 1.1 beta) and HPDCE01 into HPDCE02
# 
# 	HP revision /main/HPDCE01/1  1994/02/01  21:24  pare
# 	merge kk and hpdce01
# 
# 	HP revision /main/HPDCE01/1  1994/01/31  20:14  pare
# 	merge kk and hpdce01
# 
# Revision 1.1.15.6  1993/09/18  13:47:28  pare
# 	DCE1_0_3b03 Merge
# 	[1993/09/18  13:00:53  pare]
# 
# Revision 1.1.16.3  1993/09/15  17:48:07  root
# 	    Loading drop DCE1_0_3b03
# 	Revision 1.1.15.5  1993/09/02  17:56:25  sommerfeld
# 	clean up genpath/INCDIRS macros slightly.
# 
# Revision 1.1.16.6  1994/05/31  21:29:16  cbrooks
# 	CR 10611 - DTS needs new ACL manager
# 	[1994/05/31  21:03:56  cbrooks]
# 
# 	Checkpoint
# 	[1994/05/19  16:56:34  cbrooks]
# 
# Revision 1.1.16.5  1994/05/18  19:49:07  tom
# 	Install provider makefile and new dce_provider_util files.
# 	[1994/05/16  16:05:52  tom]
# 
# 	Bug 10627 - Add dts_provider_util for time providers.
# 
# Revision 1.1.16.4  1994/05/12  15:17:52  rhw
# 	continued code cleanup & merging
# 	[1994/05/09  18:46:47  rhw]
# 
# Revision 1.1.16.3  1994/04/21  22:05:51  cbrooks
# 	CR 3231, 8353
# 	[1994/04/21  19:59:36  cbrooks]
# 
# 	Checkpoint:4.15.94
# 	[1994/04/15  21:09:40  cbrooks]
# 
# Revision 1.1.16.2  1994/01/26  23:20:54  rhw
# 	Fix for CR 9822: dont know how to make dcedtsmac.h
# 	[1994/01/26  22:40:13  rhw]
# 
# Revision 1.1.16.1  1994/01/25  17:16:28  rsalz
# 	OT CR 9747:  Add SVC and AUD to dtsd
# 	[1994/01/25  17:15:34  rsalz]
# 
# Revision 1.1.14.2  1993/06/10  19:33:00  sommerfeld
# 	Remove stub dependancies as they're now dealt with correctly (stubs
# 	depend on header file, not vice versa).
# 	[1993/06/08  20:36:43  sommerfeld]
# 
# 	[1993/08/31  14:07:04  sommerfeld]
# 
# 	clean up genpath stuff.
# 	[1993/07/29  20:29:51  sommerfe]
# 
# Revision 1.1.15.4  1993/08/25  18:25:25  pare
# 	Add dts_spectracom_provider to ILIST and remove dts_spectracom_provider.c
# 	from examples/dts directory.
# 	[1993/08/25  18:20:56  pare]
# 
# Revision 1.1.15.3  1993/07/22  18:05:34  pare
# 	Install Makefile.tp to .../usr/examples/dts
# 	[1993/07/22  18:04:59  pare]
# 
# Revision 1.1.15.2  1993/07/08  20:03:56  root
# 	Initial King Kong branch
# 	[1993/07/08  20:03:27  root]
# 
# Revision 1.1.13.2  1993/04/05  15:55:51  truitt
# 	recreate GAMERA branch
# 	[1993/04/05  15:54:57  truitt]
# 
# Revision 1.1.13.3  1993/03/19  15:02:20  truitt
# 	Small mistake during merge process.  Replaced INCFLAGS with architecture
# 	specific directory with only target machine.
# 	[1993/03/19  15:02:00  truitt]
# 
# Revision 1.1.13.2  1993/03/19  14:57:39  truitt
# 	Merge Hp_dce1_0_1 with DCE1_0_2
# 	[1993/03/19  14:56:04  truitt]
# 
# Revision 1.1.1.8  1993/03/11  22:34:10  osfrcs
# 	    Loading drop DCE1_0_2B18
# 
# Revision 1.1.11.2  1993/03/02  16:36:22  truitt
# 	Removed unshipped acts, hopf, spectracom and traconex time
# 	providers from the install phase.
# 	[1993/03/02  16:32:57  truitt]
# 
# 	DCE 1.0.1 Release
# 	[1993/03/02  16:25:41  truitt]
# 
# Revision 1.1.6.3  1992/12/30  20:42:23  htf
# 	Embedding copyright notice
# 	[1992/12/30  19:22:15  htf]
# 
# Revision 1.1.6.2  1992/09/29  20:43:16  devsrc
# 	[OT 5373]  SNI/SVR4 Merge.
# 	[1992/09/14  20:05:49  sekhar]
# 
# Revision 1.1.1.7  1992/09/21  18:56:05  osfrcs
# 	    Loading drop Dce1_0_1fnl
# 
# Revision 1.1.3.7  1992/05/06  21:56:37  comuzzi
# 	Fix defects 2295 and 3143. Added architecture dependent dirs in common to INCFLAGS.
# 	[1992/05/06  21:25:47  comuzzi]
# 
# Revision 1.1.3.6  1992/04/10  18:41:58  mckeen
# 	Added more dependencies to order idl compiles
# 	[1992/04/10  18:41:14  mckeen]
# 
# Revision 1.1.3.5  1992/04/07  19:21:03  mckeen
# 	Merged up to mainline
# 	[1992/03/31  16:39:08  mckeen]
# 
# 	Added dependencies for dtsd_OFILES
# 	[1992/03/13  15:48:46  mckeen]
# 
# Revision 1.1.3.4  1992/02/25  16:02:45  mhickey
# 	Btool madness makes me reenter this info.  This submission
# 	reorders the PROGRAMS list to put dtsd at the end, and
# 	the dtsd_OFILES list to put all the files that generate
# 	headers from idl files, either as a primary goal, or as
# 	a side effect of generating a stub file, ahead of both
# 	dtss_service_main.o, and all other .o files.  This change
# 	is necessary because previously, dtsd attempted a recompile
# 	in the install pass due to an inter pass dependency cyle
# 	through dtss_service_main.o.  This fixes defect 2074.
# 	[1992/02/25  16:02:27  mhickey]
# 
# Revision 1.1.3.3  1992/02/24  21:36:14  mhickey
# 	Same as previous, comment went in, but not changes??
# 	[1992/02/24  21:35:52  mhickey]
# 
# Revision 1.1  1992/01/19  15:34:46  devrcs
# 	Initial revision
# 
# $EndLog$
#

VPATH = ../common:../common/POSIX:../../security/idl

##  Header and executables that are exported.
INCLUDES = dtsprovider.idl dtsprovider.acf dtsprovider.h 

PROGRAMS = dts_acts_provider dtsd dts_ntp_provider dts_null_provider \
	dts_spectracom_provider dts_traconex_provider dts_hopf_provider \
	dts_rcr_provider

EXPDIR = /usr/examples/dts/

dtsprovider.idl_EXPDIR = /usr/include/dce/
dtsprovider.acf_EXPDIR = /usr/include/dce/
dtsprovider.h_EXPDIR = /usr/include/dce/

IDLFILES = dtsprovider.idl dtsstime_req.idl dtss_globaltime_req.idl \
	lan_services.idl rdaclifv0.idl

dtsprovider_ACF = dtsprovider.acf
dtsstime_req_ACF = dtsstime_req.acf
dtss_globaltime_req_ACF = dtss_globaltime_req.acf

##  Items that are installed.

IDIR = /usr/examples/dts/

ILIST = ${INCLUDES} dtsd \
	dts_acts_provider.c \
	dts_ntp_provider \
	dts_null_provider \
	dts_spectracom_provider \
	dts_traconex_provider.c \
	dts_hopf_provider.c \
	dts_rcr_provider.c \
	dts_provider_util.h \
	dts_provider_util.c \
	Makefile.tp

#dts_acts_provider_IDIR = /bin/
#dts_hopf_provider_IDIR = /bin/
dts_ntp_provider_IDIR = /bin/
dts_null_provider_IDIR = /bin/
dts_spectracom_provider_IDIR = /bin/
#dts_traconex_provider_IDIR = /bin/
#dts_hopf_provider_IDIR = /bin/
dtsd_IDIR = /bin/
dtsprovider.acf_IDIR = /share/include/dce/
dtsprovider.h_IDIR = /share/include/dce/
dtsprovider.idl_IDIR = /share/include/dce/
dtsd_ILINKS = /bin/dtsdate

##  Compilation flags.

CFLAGS = ${${TARGET_MACHINE}_CFLAGS} -DDCE_AUD_POINTS
CFLAGS = ${${TARGET_MACHINE}_CFLAGS} -DDCE_AUD_POINTS 

INCFLAGS = -I. -I../common/${TARGET_MACHINE}/${TARGET_OS_PLATFORM} -I../common -I../common/POSIX

LIBS = -ldce ${${TARGET_MACHINE}_LIBS}

IDLFLAGS = -no_mepv -keep c_source 

IDLINCFLAGS = -I. -I../common

##  Time providers

PROVIDER_COMMON=dts_provider_util.o dtsprovider_sstub.o

dts_acts_provider_OFILES = dts_acts_provider.o ${PROVIDER_COMMON}
dts_ntp_provider_OFILES = dts_ntp_provider.o ${PROVIDER_COMMON}
dts_null_provider_OFILES = dts_null_provider.o ${PROVIDER_COMMON}
dts_spectracom_provider_OFILES = dts_spectracom_provider.o ${PROVIDER_COMMON}
dts_traconex_provider_OFILES = dts_traconex_provider.o ${PROVIDER_COMMON}
dts_hopf_provider_OFILES = dts_hopf_provider.o ${PROVIDER_COMMON}
dts_rcr_provider_OFILES = dts_rcr_provider.o ${PROVIDER_COMMON}

rdaclifv0.idl_IDLFLAGS = -keep c_source -no_mepv
rdaclifv0.idl_ACF = rdaclifv0.acf

##  DTSD

dtsd_OFILES = \
	dtsstime_req_cstub.o dtsstime_req_sstub.o \
	dtss_globaltime_req_cstub.o dtss_globaltime_req_sstub.o \
	dtsprovider_cstub.o lan_services_cstub.o dtss_service_main.o \
	clock_adjust.o mgtrpc.o mgtacl.o dtss_service_state.o transport.o \
	clock_Adjust.o dtss_service_global_set.o \
	logevent.o dtss_service_ncl.o dtss_malloc.o timers.o \
	events.o events_unix.o provider_interface.o time_request.o \
	transport_rpc.o svc.o dcedtssvc.o acl_compat.o rdaclifv0_sstub.o \
	setVars.o querydced.o

dtsd_LIBS = -laudit -ldtss_common ${LIBS} # -lutc-user ${LIBS} # -ldpeacl ${LIBS}

.include <${RULES_MK}>

${dtsd_OFILES}: dtsprovider.h dtsstime_req.h dtss_globaltime_req.h \
	lan_services.h 

dts_provider_util.o dts_acts_provider.o dts_ntp_provider.o \
dts_null_provider.o dts_spectracom_provider.o dts_traconex_provider.o \
dts_hopf_provider.o: dts_provider_util.h dtsprovider.h


.SUFFIXES: .flow 

.c.flow: 
	@/bin/echo "CFLAGS="${_CCFLAGS_}
	cflow -Aa ${CCMDFLAGS} ${_CCFLAGS_} ${.IMPSRC}
