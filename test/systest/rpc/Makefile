# @OSF_COPYRIGHT@
# COPYRIGHT NOTICE
# Copyright (c) 1990, 1991, 1992, 1993, 1996 Open Software Foundation, Inc.
# ALL RIGHTS RESERVED (DCE).  See the file named COPYRIGHT.DCE in the
# src directory for the full copyright text.
# 
# HISTORY
# $Log: Makefile,v $
# Revision 1.1.29.2  1996/03/11  02:45:05  marty
# 	Update OSF copyright years
# 	[1996/03/10  20:07:50  marty]
#
# Revision 1.1.29.1  1995/12/11  22:00:31  root
# 	Submit OSF/DCE 1.2.1
# 
# 	HP revision /main/HPDCE02/3  1995/08/10  16:07 UTC  jss
# 	Added new objects for perf test.
# 
# 	HP revision /main/HPDCE02/2  1994/10/26  19:42 UTC  bissen
# 
# 	HP revision /main/HPDCE02/1  1994/06/29  20:10 UTC  bissen
# 	Merge hpdce02 (DCE 1.1 beta) and HPDCE01 into HPDCE02
# 
# 	HP revision /main/HPDCE01/4  1994/03/30  18:52 UTC  truitt
# 
# 	HP revision /main/HPDCE01/truitt_junk/3  1994/03/30  18:46 UTC  truitt
# 	Update to reflect no acf test
# 
# 	HP revision /main/HPDCE01/truitt_junk/2  1994/03/29  19:05 UTC  truitt
# 	Add rec.clientwrapper file
# 
# 	HP revision /main/HPDCE01/truitt_junk/1  1994/03/28  20:55 UTC  truitt
# 	Add new file for dcerpbnk
# 
# 	HP revision /main/HPDCE01/1  1994/01/27  15:41  bissen
# 	merge kk and hpdce01
# 	[1995/12/11  20:59:40  root]
# 
# Revision 1.1.23.5  1993/10/16  21:08:33  cmckeen
# 	Merged with changes from 1.1.23.4
# 	[1993/10/16  21:08:28  cmckeen]
# 
# 	Added rpc.sec.2 and rpc.cds.3 back to the SUBDIRS line
# 	[1993/10/16  21:07:44  cmckeen]
# 
# Revision 1.1.23.4  1993/10/15  21:15:53  ohara
# 	SVR4 porting changes - 8596
# 	[1993/10/15  16:35:20  ohara]
# 
# Revision 1.1.23.3  1993/09/17  13:13:06  qbarry
# 	Took out subdir RPC.SEC.2 for now just to get a clean build.
# 	[1993/09/17  13:12:28  qbarry]
# 
# Revision 1.1.23.2  1993/09/14  12:58:08  cmckeen
# 	 Temporarily removing rpc.cds.3 from SUBDIRS
# 	[1993/09/14  12:57:54  cmckeen]
# 
# Revision 1.1.23.1  1993/09/10  14:46:11  cmckeen
# 	Added rpc.runtime.1, rpc.sec.2, and rpc.cds.3 to SUBDIRS line
# 	[1993/09/10  14:45:30  cmckeen]
# 
# Revision 1.1.21.6  1993/08/27  21:03:13  pellis
# 	Removed +e from CFLAGS and only append it to CFLAGS if TARGET_OS is
# 	not AIX, the +e on AIX causes compiler errors.
# 	[1993/08/27  21:01:43  pellis]
# 
# Revision 1.1.21.5  1993/08/13  18:48:18  cmckeen
# 	Specified IDIR for dcerpbnk.data and added dcerpbnk.data to OTHERS (to
# 	be included in ILIST).
# 	[1993/08/03  19:04:18  cmckeen]
# 
# Revision 1.1.21.4  1993/08/06  14:46:08  msoni
# 	Fixed to work on HPUX.
# 	[1993/08/06  14:33:24  msoni]
# 
# Revision 1.1.21.3  1993/08/02  17:30:57  cmckeen
# 	 Changes made to reflect the new install tree
# 	[1993/08/02  17:16:54  cmckeen]
# 
# Revision 1.1.21.2  1993/07/28  19:32:33  cmckeen
# 	HP's TET'ized version of the system tests
# 	[1993/07/28  14:24:01  cmckeen]
# 
# Revision 1.1.7.5  1993/08/27  20:54:58  giza
# 	fixed IDIRs for TET
# 	[1993/08/27  20:54:40  giza]
# 
# Revision 1.1.7.4  1993/08/25  15:40:05  giza
# 	Added dcerpcrun.
# 	[1993/08/25  15:39:36  giza]
# 
# Revision 1.1.7.3  1993/08/24  19:50:55  bissen
# 	Added SUBDIRS for 1.0.2 system tests
# 	[1993/08/24  19:50:33  bissen]
# 
# Revision 1.1.7.2  1993/07/09  12:06:25  root
# 	Initial King Kong branch
# 	[1993/07/09  12:05:57  root]
# 
# Revision 1.1.5.4  1993/05/04  18:25:20  giza
# 	*** empty log message ***
# 
# Revision 1.1.5.3  1993/04/30  17:08:26  eheller
# 	*** empty log message ***
# 	[1993/04/30  17:06:59  eheller]
# 
# Revision 1.1.5.2  1993/04/23  14:41:43  giza
# 	dce1.0.2 merge up and systest timing mods
# 	[1993/04/23  13:39:46  giza]
# 
# Revision 1.1.3.9  1992/11/25  19:38:43  mgm
# 	Added tet* files to install
# 	[1992/11/25  19:38:14  mgm]
# 
# Revision 1.1.3.8  1992/11/20  20:56:26  mgm
# 	Added tet_scen to install
# 	[1992/11/20  20:56:04  mgm]
# 
# Revision 1.1.3.7  1992/11/17  12:44:22  mgm
# 	Added rpt.rpc and run.rpc to install.
# 	[1992/11/17  12:43:42  mgm]
# 
# Revision 1.1.3.6  1992/11/11  20:59:14  mgm
# 	Fixed install bug
# 	[1992/11/11  20:58:38  mgm]
# 
# Revision 1.1.3.5  1992/11/11  20:05:11  mgm
# 	Can now install tests to proper directories in
# 	release area.
# 	[1992/11/11  20:04:33  mgm]
# 
# Revision 1.1.3.4  1992/11/03  22:41:17  mgm
# 	Added ILIST and SCRIPTS for information until we can
# 	restructure the TET files
# 	[1992/11/03  22:40:46  mgm]
# 
# Revision 1.1.3.3  1992/11/03  22:36:42  mgm
# 	Ported to HPUX
# 	[1992/11/03  22:36:12  mgm]
# 
# Revision 1.1.3.2  1992/06/11  19:51:38  mcfarland
# 	changed files from test_latest
# 	[1992/06/09  12:59:29  mcfarland]
# 
# Revision 1.1.1.2  1992/05/28  15:11:18  root
# 	    Loading drop Dce1_0_1b15
# 
# Revision 1.1.3.7  1992/05/21  21:15:53  gmd
# 	Added transactions to the program list (used by dcerpbnk system test)
# 	[1992/05/21  20:00:18  gmd]
# 
# Revision 1.1.3.6  1992/05/06  16:56:48  rps
# 	Fix merge (extraneous _util.o objects))
# 	[1992/05/06  16:55:41  rps]
# 
# Revision 1.1.3.5  1992/04/22  22:04:57  rps
# 	Remove -no_mepv from IDLFLAGS
# 	[1992/04/22  15:05:18  rps]
# 
# Revision 1.1.3.4  1992/04/21  19:11:20  rps
# 	Incorporate Kevin's shared sandbox fix:
# 	Changed the way the _server.c and _client.c files are built. The
# 	previous method did not allow for multiple backing trees. I added
# 	a _server.c and _client.c dependency and then added a simple dependency
# 	rule.
# 	[1992/04/21  19:10:53  rps]
# 
# Revision 1.1.3.3  1992/04/15  16:53:11  rps
# 	Use tools libs
# 	Add idl .h dependencies
# 	[1992/04/15  15:55:13  rps]
# 
# Revision 1.1.3.2  1992/03/18  01:18:42  rps
# 	Initial version
# 	[1992/03/18  00:45:43  rps]
# 
# $EndLog$
#
#
common_functions_IDIR	= /tet/rpc/ts/

dcerpary_IDIR		= /tet/rpc/ts/dcerpary/
dcerpbnk_IDIR		= /tet/rpc/ts/dcerpbnk/
bnk.functions_IDIR	= /tet/rpc/ts/dcerpbnk/
bnk.clientwrapper_IDIR	= /tet/rpc/ts/dcerpbnk/
dcerpidl_IDIR		= /tet/rpc/ts/dcerpidl/
dcerpper_IDIR		= /tet/rpc/ts/dcerpper/
dcerprec_IDIR		= /tet/rpc/ts/dcerprec/
rec.functions_IDIR	= /tet/rpc/ts/dcerprec/
rec.clientwrapper_IDIR	= /tet/rpc/ts/dcerprec/

ary_server_IDIR 	= /tet/rpc/ts/dcerpary/
ary_client_IDIR 	= /tet/rpc/ts/dcerpary/

bankd_IDIR 		= /tet/rpc/ts/dcerpbnk/
bank_IDIR 		= /tet/rpc/ts/dcerpbnk/
transactions_IDIR 	= /tet/rpc/ts/dcerpbnk/

pipe_client_IDIR 	= /tet/rpc/ts/dcerpidl/
pipe_server_IDIR 	= /tet/rpc/ts/dcerpidl/
repas_client_IDIR 	= /tet/rpc/ts/dcerpidl/
repas_server_IDIR 	= /tet/rpc/ts/dcerpidl/
scal_client_IDIR 	= /tet/rpc/ts/dcerpidl/
scal_server_IDIR 	= /tet/rpc/ts/dcerpidl/
union_client_IDIR 	= /tet/rpc/ts/dcerpidl/
union_server_IDIR 	= /tet/rpc/ts/dcerpidl/
xmitas_client_IDIR 	= /tet/rpc/ts/dcerpidl/
xmitas_server_IDIR 	= /tet/rpc/ts/dcerpidl/

perf_client_IDIR 	= /tet/rpc/ts/dcerpper/
perf_server_IDIR 	= /tet/rpc/ts/dcerpper/

rec_client_IDIR 	= /tet/rpc/ts/dcerprec/
rec_server_IDIR 	= /tet/rpc/ts/dcerprec/
str_client_IDIR 	= /tet/rpc/ts/dcerprec/
str_server_IDIR 	= /tet/rpc/ts/dcerprec/

tet_code_IDIR		= /tet/rpc/
tet_scen_IDIR		= /tet/rpc/
tetbuild.cfg_IDIR	= /tet/rpc/
tetclean.cfg_IDIR	= /tet/rpc/
tetexec.cfg_IDIR	= /tet/rpc/

SUBDIRS		= rpc.sec.2 rpc.runtime.1 rpc.cds.3

ILIST		= common_functions ${SCRIPTS} ${PROGRAMS}

SCRIPTS		= dcerpary dcerpbnk bnk.functions bnk.clientwrapper \
		  dcerpidl dcerpper dcerprec rec.functions rec.clientwrapper \
		  tet_scen tet_code \
		  tetbuild.cfg tetclean.cfg tetexec.cfg

PROGRAMS	= ary_server ary_client \
		  bankd bank transactions \
		  pipe_server pipe_client \
		  repas_server repas_client \
		  scal_client scal_server \
	 	  union_server union_client \
		  xmitas_server xmitas_client \
		  perf_server perf_client \
		  rec_server rec_client \
		  str_server str_client

VPATH		= ../../rpc/runtime/perf

INCFLAGS        = -I../tools -I../../rpc/runtime/perf

CFLAGS		= -g -D_BSD -Dunix -DIDL_NO_PROTOTYPES ${${TARGET_MACHINE}_CFLAGS}

.if ${TARGET_OS} == "HPUX"
CFLAGS		+= +e
.endif

LIBFLAGS	= -L../tools 
LIBS		= -lutil -lxx_ -lm ${${TARGET_MACHINE}_LIBS} -ldce 

.if ${TARGET_OS} != "AIX"
LIBS		+= -lBSD
.endif

ary_server_OFILES =  ary_server.o ary_sstub.o ary_util.o                  
ary_client_OFILES =  ary_client.o ary_cstub.o ary_util.o

admin_sstub.c_IDLFLAGS	= -no_mepv
trans_sstub.c_IDLFLAGS	= -no_mepv
bank_OFILES = bank.o admin_cstub.o trans_cstub.o bnk_util.o
bankd_OFILES = bankd.o admin_sstub.o trans_sstub.o bnk_util.o

perf_sstub.c_IDLFLAGS	= -no_mepv
perfg_sstub.c_IDLFLAGS	= -no_mepv
perf_server_OFILES = perf_server.o perf_sstub.o perfb_sstub.o perfc_cstub.o \
		perfg_sstub.o perfp_sstub.o perfp.o perfb.o perfg.o perf_util.o perf.o
perf_client_OFILES = perf_client.o perf_cstub.o perfb_cstub.o perfc_sstub.o \
		perfg_cstub.o perfp_cstub.o perf_util.o

pipe_server_OFILES = pipe_server.o pipe_sstub.o pipe_saux.o pipe_mgr.o
pipe_client_OFILES = pipe_client.o pipe_aux.o pipe_cstub.o

rec_server_OFILES = rec_server.o recov_sstub.o
rec_client_OFILES = rec_client.o recov_cstub.o

repas_server_OFILES = repas_server.o repas_sstub.o repas_saux.o repas_mgr.o \
		util_cvt.o
repas_client_OFILES = repas_client.o repas_aux.o repas_cstub.o repas_caux.o \
		util_cvt.o

scal_server_OFILES = scal_server.o scal_sstub.o scal_mgr.o
scal_client_OFILES = scal_client.o scal_aux.o scal_cstub.o

str_server_OFILES = str_server.o str_sstub.o
str_client_OFILES = str_client.o str_cstub.o

union_server_OFILES = union_server.o sp_union_sstub.o sp_union_saux.o \
		union_mgr.o
union_client_OFILES = union_client.o union_aux.o sp_union_caux.o \
		sp_union_cstub.o

xmitas_server_OFILES = xmitas_server.o xmitas_sstub.o xmitas_saux.o \
		xmitas_mgr.o util_xmit.o
xmitas_client_OFILES = xmitas_client.o xmitas_aux.o xmitas_cstub.o \
		util_xmit.o

IDLFLAGS        = -keep c_source
IDLINCFLAGS	= -I.
IDLFILES        = acct_type.idl  ary.idl        repas.idl      str.idl \
		pipe.idl       scal.idl       trans.idl \
		admin.idl      recov.idl      sp_union.idl   xmitas.idl \
		perf.idl perfb.idl perfc.idl perfg.idl

.if exists(${TARGET_MACHINE}/machdep.mk)
.include "${TARGET_MACHINE}/machdep.mk"
.endif
.include <${RULES_MK}>

ary_server.o ary_client.o ary_util.o : ary.h
bank.o bankd.o : acct_type.h admin.h trans.h
perf_server.o perf_client.o perf.o perfb.o perfg.o perf_util.o :\
	 perf.h perfb.h perfc.h perfg.h
pipe_server.o pipe_client.o pipe_mgr.o pipe_aux.o : pipe.h
rec_server.o rec_client.o : recov.h
repas_server.o repas_client.o repas_aux.o repas_mgr.o util_cvt.o: repas.h
scal_server.o scal_client.o scal_aux.o scal_mgr.o : scal.h
str_server.o str_client.o : str.h
union_server.o union_client.o union_aux.o union_mgr.o : sp_union.h
xmitas_server.o xmitas_client.o xmitas_aux.o xmitas_mgr.o util_xmit.o : xmitas.h

rec_server.c str_server.c : server.c
rec_client.c str_client.c : client.c

# utter kluges, but ${${.TARGET:_foo.c=.c}:P} doesn't work
# Yet another utter kludge. SOURCEDIR really doesn't work. 
# Note the dependency line above.. kevins

rec_server.c :
	sed 's/dummy_if/recov/g' $? > $@
rec_client.c :
	sed 's/dummy_if/recov/g' $? > $@
str_server.c :
	sed 's/dummy_if/str/g' $? > $@
str_client.c :
	sed 's/dummy_if/str/g' $? > $@

# The perf sources are from the rpc runtime test suite.

perf_server.c : ${MAKETOP}test/rpc/runtime/perf/server.c
perf_client.c : ${MAKETOP}test/rpc/runtime/perf/client.c
perf_util.c : ${MAKETOP}test/rpc/runtime/perf/util.c

perf_server.c :
	cp  $? $@
perf_client.c :
	cp  $? $@
perf_util.c :
	cp  $? $@
